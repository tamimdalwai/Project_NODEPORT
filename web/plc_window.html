<!DOCTYPE html>
<html>
<head>
    <title id="title"></title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1 id="plcTitle"></h1>
        <div class="status-bar">
            <div>Sampling: <span id="sampling"></span></div>
            <div>Change Threshold: <span id="threshold"></span></div>
        </div>

        <div class="scrollable-table">
            <table>
                <thead>
                    <tr>
                        <th>Coil Address</th>
                        <th>Coil State</th>
                        <th>Input Address</th>
                        <th>Input State</th>
                        <th>Register Address</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let plcName = localStorage.getItem('currentPlc');
        document.getElementById('plcTitle').textContent = plcName;

        async function refreshData() {
            const data = await window.pywebview.api.get_plc_data(plcName);
            updateTable(data);
        }

        function updateTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            // Display coil states
            for (const [address, state] of Object.entries(data.coil_states)) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${address}</td>
                    <td>${state}</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                `;
                tbody.appendChild(row);
            }

            // Display input status states
            for (const [address, state] of Object.entries(data.input_status_states)) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td></td>
                    <td></td>
                    <td>${address}</td>
                    <td>${state}</td>
                    <td></td>
                    <td></td>
                `;
                tbody.appendChild(row);
            }

            // Display input register states
            for (const [address, value] of Object.entries(data.input_register_states)) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>${address}</td>
                    <td>${value}</td>
                `;
                tbody.appendChild(row);
            }
        }

        // Auto-refresh every second
        setInterval(refreshData, 1000);
        refreshData();

        window.addEventListener('pywebviewready', function() {
            window.pywebview.api.on_closed(function() {
                window.pywebview.api.cleanup();
            });
        });
    </script>
</body>
</html>